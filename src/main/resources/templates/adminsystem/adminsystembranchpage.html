<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{branch1.list.title}">Branch List</title>

    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/adminsystembranchpage.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
</head>

<body>

<div class="home-container">

    <div th:replace="layouts/adminsystemsidebar :: adminSystemSidebar"></div>

    <div class="main-content">

        <div class="branch-container">

            <div class="branch-header">
                <h2 th:text="#{branch1.list.title}">Danh sách chi nhánh</h2>

                <button class="btn-add-branch"
                        data-bs-toggle="modal"
                        data-bs-target="#createBranchModal"
                        th:text="#{branch1.add.button}">
                </button>
            </div>

            <div id="branchContainer"></div>

        </div>
    </div>
</div>

<!-- MODAL TẠO CHI NHÁNH -->
<div class="modal fade" id="createBranchModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <form id="createBranchForm">
                <div class="modal-header">
                    <h5 class="modal-title" th:text="#{branch1.modal.title}">Tạo chi nhánh mới</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <label th:text="#{branch1.name}">Tên chi nhánh</label>
                    <input name="name" class="form-control" required>

                    <label class="mt-2" th:text="#{branch1.location}">Địa chỉ</label>
                    <input name="location" class="form-control" required>

                    <label class="mt-2" th:text="#{branch1.description}">Mô tả</label>
                    <textarea name="description" class="form-control"></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal"
                            th:text="#{button1.cancel}">
                    </button>

                    <button type="submit" class="btn btn-success"
                            th:text="#{button1.create}">
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

<!-- MODAL: Tạo sân mới -->
<div class="modal fade" id="createPitchModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <form id="createPitchForm" enctype="multipart/form-data">
                <input type="hidden" id="pitchBranchId" name="branchId">

                <div class="modal-header">
                    <h5 class="modal-title">
                        <span th:text="#{pitch1.add.title}"></span>
                        <span id="pitchBranchName" class="text-primary"></span>
                    </h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <label th:text="#{pitch1.name}">Tên sân</label>
                    <input name="name" class="form-control" required>

                    <label class="mt-2" th:text="#{pitch1.location}">Vị trí</label>
                    <input name="location" class="form-control" required>

                    <label class="mt-2" th:text="#{pitch1.description}">Mô tả</label>
                    <textarea name="description" class="form-control"></textarea>

                    <label class="mt-3">Loại sân</label>
                    <select name="pitchTypeId" class="form-select" required>
                        <option value="5">5 người</option>
                        <option value="7">7 người</option>
                        <option value="11">11 người</option>
                    </select>

                   <label class="mt-3" th:text="#{pitch1.images}">Ảnh sân</label>

<div class="custom-file-upload">
    <label id="fileLabel" class="file-btn">
        <i class="fa-solid fa-upload"></i> <span id="fileText">[[#{pitch1.chooseFile}]]</span>
        <input type="file" name="file" id="pitchFiles" multiple hidden>
    </label>
</div>
<p class="file-info" id="fileInfo">[[#{pitch1.noFile}]]</p>

                </div>

                <div class="modal-footer">
                    <button type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                            th:text="#{button1.cancel}">
                        Cancel
                    </button>

                    <button type="submit"
                            class="btn btn-primary"
                            th:text="#{button1.create}">
                        Tạo sân
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>
<!-- I18N -->
<script th:inline="javascript">
    const i18n = {
        loading: '[[#{loading}]]',
        error: '[[#{error}]]',
        empty: '[[#{empty}]]',
        statusActive: '[[#{pitch.status.active}]]',
        statusInactive: '[[#{pitch.status.inactive}]]',
        addPitch: '[[#{add.pitch}]]',
        type: '[[#{pitch1.type}]]',
        images: '[[#{pitch1.images}]]',
        chooseFile: '[[#{pitch1.chooseFile}]]',
        noFile: '[[#{pitch1.noFile}]]'
    };
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/adminsystem-branches.js"></script>

<script>
    loadAdminBranches();

    document.getElementById("createBranchForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const payload = {
            name: e.target.name.value,
            location: e.target.location.value,
            description: e.target.description.value
        };

        const res = await fetch("/api/adminsystem/branches", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${localStorage.getItem("accessToken")}`
            },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            alert(i18n.error);
            return;
        }

        loadAdminBranches();
        bootstrap.Modal.getInstance(document.getElementById("createBranchModal")).hide();
    });
</script>

</body>
</html>
