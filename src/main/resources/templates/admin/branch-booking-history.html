<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="#{booking.history.title}">Booking History - Admin</title>

  <!-- Fonts & CSS -->
  <link rel="stylesheet" th:href="@{/css/home.css}">
  <link rel="stylesheet" th:href="@{/css/adminbranchbooking.css}">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body onload="loadBranchBookings(0)">
<div class="home-container">

  <!-- üåê Language Switcher -->
  <div th:replace="layouts/langswitcher :: langSwitcher"></div>

  <!-- üß≠ Sidebar -->
  <div th:replace="layouts/adminbranchsidebar :: adminSidebar"></div>

  <!-- üß± Main Content -->
  <div class="main-content">
    <div class="booking-history-container">
      <h2 th:text="#{booking.history.title}">L·ªãch s·ª≠ ƒë·∫∑t s√¢n</h2>

      <!-- Toolbar -->
      <div class="bh-toolbar">
        <!-- Left: page size -->
        <div class="bh-left">
          <label th:text="#{booking.history.show}">Hi·ªÉn th·ªã</label>
          <select id="pageSize" onchange="changePageSize(this.value)">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
          <span th:text="#{booking.history.itemsPerPage}">m·ª•c / trang</span>
        </div>

        <!-- Right: filter -->
        <div class="filter-bar">
          <div class="filter-group">

            <!-- Ng∆∞·ªùi d√πng -->
            <div class="filter-box">
              <i class="fa fa-user"></i>
              <input type="text"
                     id="searchKeyword"
                     th:placeholder="#{user.info.fullName}"
                     onkeyup="applyFilters()">
            </div>

            <!-- T√™n s√¢n -->
            <div class="filter-box">
              <i class="fa fa-futbol"></i>
              <input type="text"
                     id="filterPitchName"
                     th:placeholder="#{booking.table.pitch}"
                     onkeyup="applyFilters()">
            </div>

            <!-- Tr·∫°ng th√°i -->
            <div class="filter-select">
              <i class="fa fa-list"></i>
              <select id="filterStatus" onchange="applyFilters()">
                <option value="" th:text="#{booking.table.status}">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                <option value="APPROVED" th:text="#{status.approved}"></option>
                <option value="WAITING_REFUND" th:text="#{status.waiting_refund}"></option>
                <option value="REFUNDED" th:text="#{status.refunded}"></option>
                <option value="CANCELLED" th:text="#{status.cancelled}"></option>
              </select>
            </div>

            <!-- T·ª´ ng√†y -->
            <div class="filter-date">
              <i class="fa fa-calendar-alt"></i>
              <input type="datetime-local" id="filterStartDate" onchange="applyFilters()">
            </div>

            <!-- ƒê·∫øn ng√†y -->
            <div class="filter-date">
              <i class="fa fa-calendar-check"></i>
              <input type="datetime-local" id="filterEndDate" onchange="applyFilters()">
            </div>

            <!-- N√∫t reset -->
            <button class="filter-reset" onclick="resetFilters()">
              <i class="fa fa-rotate-left"></i>
              <span th:text="#{filter.reset}">X√≥a b·ªô l·ªçc</span>
            </button>
          </div>

          <span id="summaryText"></span>
        </div>
      </div>

      <!-- Table -->
      <table class="booking-table">
        <thead>
        <tr>
          <th th:text="#{booking.table.no}">#</th>
          <th th:text="#{booking.table.pitch}">S√¢n</th>
          <th th:text="#{booking.table.branch}">Chi nh√°nh</th>
          <th th:text="#{booking.table.date}">Ng√†y ƒë·∫∑t</th>
          <th th:text="#{booking.table.status}">Tr·∫°ng th√°i</th>
          <th th:text="#{booking.table.price}">Gi√°</th>
          <th th:text="#{booking.table.detail}">Chi ti·∫øt</th>
          <th th:text="#{action.title}">H√†nh ƒë·ªông</th>
        </tr>
        </thead>
        <tbody id="branchBookingList"></tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" id="pagination"></div>
    </div>
  </div>
</div>

<!-- Modal chi ti·∫øt -->
<div id="bookingModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 th:text="#{booking.summary.title}">Chi ti·∫øt ƒë·∫∑t s√¢n</h3>
      <button class="close-btn" onclick="closeModal()">&times;</button>
    </div>

    <div class="modal-body">
      <p><strong th:text="#{booking.summary.pitch}">S√¢n:</strong> <span id="modalPitch"></span></p>
      <p><strong th:text="#{booking.summary.branch}">Chi nh√°nh:</strong> <span id="modalBranch"></span></p>
      <p><strong th:text="#{booking.summary.user}">Ng∆∞·ªùi ƒë·∫∑t:</strong> <span id="modalUser"></span></p>
      <p><strong th:text="#{booking.summary.date}">Ng√†y:</strong> <span id="modalDate"></span></p>
      <p><strong th:text="#{booking.summary.status}">Tr·∫°ng th√°i:</strong> <span id="modalStatus"></span></p>
      <p><strong th:text="#{booking.summary.note}">Ghi ch√∫:</strong> <span id="modalNote"></span></p>

      <div id="modalSlotsSection">
        <h4 th:text="#{booking.summary.slots}">C√°c khung gi·ªù ƒë√£ ƒë·∫∑t</h4>
        <ul id="modalSlotsList"></ul>
      </div>

      <div class="modal-footer">
        <button class="close-btn-footer" onclick="closeModal()" th:text="#{booking.close}">ƒê√≥ng</button>
      </div>
    </div>
  </div>
</div>

<!-- Inject JS i18n -->
<script th:inline="javascript">
/*<![CDATA[*/
  const i18n = {
    status: {
      PENDING: /*[[#{status.pending}]]*/ 'Pending',
      APPROVED: /*[[#{status.approved}]]*/ 'Approved',
      WAITING_REFUND: /*[[#{status.waiting_refund}]]*/ 'Waiting Refund',
      REFUNDED: /*[[#{status.refunded}]]*/ 'Refunded',
      CANCELLED: /*[[#{status.cancelled}]]*/ 'Cancelled'
    },
    action: {
      cancel: /*[[#{action.cancel}]]*/ "H·ªßy",
      refund: /*[[#{action.refund}]]*/ "Ho√†n ti·ªÅn"
    },
    table: {
      noData: /*[[#{booking.table.noData}]]*/ 'No data',
      view: /*[[#{booking.table.view}]]*/ 'View'
    },
    pagination: /*[[#{pagination.range}]]*/ '{0}‚Äì{1} / {2}',
    filter: {
      reset: /*[[#{filter.reset}]]*/ 'Clear filters'
    },
    alert: {
      notLoggedIn: /*[[#{auth.notLoggedIn}]]*/ 'You are not logged in',
      updateSuccess: /*[[#{alert.updateSuccess}]]*/ 'Updated successfully!',
      updateFail: /*[[#{alert.updateFail}]]*/ 'Update failed!'
    },
    confirm: {
      refund: /*[[#{confirm.refund}]]*/ 'Are you sure to refund this booking?',
      cancel: /*[[#{confirm.cancel}]]*/ 'Are you sure to cancel this booking?'
    },
    note: {
      refund: /*[[#{note.refund}]]*/ 'Refunded via customer bank account.',
      cancel: /*[[#{note.cancel}]]*/ 'Cancelled by branch admin.'
    },
    error: {
      loadFail: /*[[#{error.loadFail}]]*/ 'Failed to load data',
      updateFail: /*[[#{error.updateFail}]]*/ 'Failed to update booking',
      notFound: /*[[#{error.notFound}]]*/ 'Booking not found'
    }
  };
/*]]>*/
</script>

<!-- JS -->
<script th:src="@{/js/auth.js}"></script>
<script th:src="@{/js/adminbranchbooking.js}"></script>
<script th:src="@{/js/lang-switcher.js}"></script>

</body>
</html>
